{
    "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
    "padding": 0,
    "hconcat": [
        {
            "width": 300,
            "height": 250,
            "title": {
                "text": "Number of persons engaged by Gender",
                "dy": -15,  
                "font": "open sans"
            },
            "data": {
                "url": "https://raw.githubusercontent.com/chengsj0311/FIT3179_Project2/refs/heads/main/data/no_of_persons_by_cert.csv"
            },
            "transform": [
                {
                    "aggregate": [
                        {
                            "op": "sum",
                            "field": "no_of_persons",
                            "as": "total_persons_by_gender"
                        }
                    ],
                    "groupby": [
                        "Gender"
                    ]
                }
            ],
            "layer": [
                {
                    "params": [
                        {
                            "name": "select",
                            "select": {
                                "type": "point",
                                "fields": [
                                    "Gender"
                                ]
                            }
                        }
                    ],
                    "mark": {
                        "type": "arc",
                        "innerRadius": 50,
                        "cursor": "pointer"
                    },
                    "encoding": {
                        "fillOpacity": {
                            "condition": {
                                "param": "select",
                                "value": 1
                            },
                            "value": 0.5
                        },
                        "theta": {
                            "field": "total_persons_by_gender",
                            "type": "quantitative"
                        },
                        "color": {
                            "field": "Gender",
                            "type": "nominal",
                            "legend": null
                        } 
                    }
                },
                {
                    "data": {
                        "url": "https://raw.githubusercontent.com/chengsj0311/FIT3179_Project2/refs/heads/main/data/no_of_persons_by_cert.csv"
                    },
                    "transform": [
                        {
                            "aggregate": [
                                {
                                    "op": "sum",
                                    "field": "no_of_persons",
                                    "as": "total_persons"
                                }
                            ]
                        }
                    ],
                    "mark": {
                        "type": "text",
                        "dx": 0,
                        "dy": 15
                    },
                    "encoding": {
                        "text": {
                            "field": "total_persons",
                            "format": ","
                        }
                    }
                },
                {
                    "data": {
                        "url": "https://raw.githubusercontent.com/chengsj0311/FIT3179_Project2/refs/heads/main/data/no_of_persons_by_cert.csv"
                    },
                    "transform": [
                        {
                            "filter": "datum.Gender === 'Male'"
                        },
                        {
                            "aggregate": [
                                {
                                    "op": "sum",
                                    "field": "no_of_persons",
                                    "as": "total_persons"
                                }
                            ]
                        }
                    ],
                    "mark": {
                        "type": "text",
                        "fontSize": 12,
                        "dx": -85,
                        "dy": 15,
                        "color": "#ffffff"
                    },
                    "encoding": {
                        "text": {
                            "field": "total_persons"
                        }
                    }
                },
                {
                    "data": {
                        "url": "https://raw.githubusercontent.com/chengsj0311/FIT3179_Project2/refs/heads/main/data/no_of_persons_by_cert.csv"
                    },
                    "transform": [
                        {
                            "filter": "datum.Gender === 'Female'"
                        },
                        {
                            "aggregate": [
                                {
                                    "op": "sum",
                                    "field": "no_of_persons",
                                    "as": "total_persons"
                                }
                            ]
                        }
                    ],
                    "mark": {
                        "type": "text",
                        "fontSize": 12,
                        "dx": 85,
                        "dy": 15,
                        "color": "#ffffff"
                    },
                    "encoding": {
                        "text": {
                            "field": "total_persons"
                        }
                    }
                },
                {
                    "mark": {
                        "type": "text",
                        "fontSize": 16,
                        "dx": 0,
                        "dy": -5,
                        "text": "Total"
                    }
                },
                {
                    "mark": {
                        "type": "text",
                        "fontSize": 16,
                        "color": "#ffffff",
                        "dx": -85,
                        "dy": -5,
                        "text": "Male"
                    }
                },
                {
                    "mark": {
                        "type": "text",
                        "color": "#ffffff",
                        "fontSize": 16,
                        "dx": 85,
                        "dy": -5,
                        "text": "Female"
                    }
                }
            ]
        },
        {
            "transform": [
                {
                    "filter": {
                        "param": "select"
                    }
                }
            ],
            "width": 300,
            "height": 250,
            "title": {
                "text": "Number of persons engaged by Certification",
                "dy": -15,  
                "font": "open sans"
            },
            "data": {
                "url": "https://raw.githubusercontent.com/chengsj0311/FIT3179_Project2/refs/heads/main/data/no_of_persons_by_cert.csv"
            },
            "layer": [
                {
                    "mark": "bar",
                    "encoding": {
                        "x": {
                            "field": "no_of_persons",
                            "type": "quantitative",
                            "title": "Number of persons",
                            "axis": {
                                "format": "~s"
                            }
                        },
                        "y": {
                            "field": "certificate",
                            "type": "nominal",
                            "sort": "-x"
                        },
                        "opacity": {
                            "condition": {
                                "test": "datum.certificate === 'SPM'",
                                "value": 1
                            },
                            "value": 0.3
                        },
                        "color": {
                            "field": "Gender",
                            "sort": "descending",
                            "legend": null
                        }
                    }
                },
                {
                    "mark": {
                        "type": "text",
                        "baseline": "middle",
                        "dx": 25   
                    },
                    "encoding": {
                        "x": {
                            "aggregate": "sum",
                            "field": "no_of_persons",
                            "stack":"normalize",
                            "bandPosition": 0.5
                        },
                        "y": {
                            "field": "certificate",
                            "sort": "-x"
                        },
                        "text": {
                            "aggregate": "sum",
                            "field": "no_of_persons",
                            "type": "quantitative",
                            "format": ","
                        }
                    }
                }
            ]
        }
    ],
    "spacing": 90,
    "config": {
        "style": {
            "cell": {
                "stroke": "transparent"
            }
        },
        "font": "Arial",
        "title": {
            "fontSize": 18,
            "font": "open sans"
        }
    }
}